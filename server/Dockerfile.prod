FROM node:20-alpine
WORKDIR /app

# Tools for building native modules (e.g., bcrypt)
RUN apk add --no-cache python3 make g++ openssl

# Install all deps (dev included for start:dev)
COPY package.json package-lock.json* ./
RUN npm ci

# Copy sources
COPY . .

# Generate Prisma client after schema is available
RUN npx prisma generate || true

ENV NODE_ENV=development

# Expose API port
EXPOSE 4200

# Run Nest in watch mode
CMD ["npm", "run", "start:dev"]
