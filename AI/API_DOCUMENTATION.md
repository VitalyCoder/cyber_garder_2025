# üìò ZenBalance AI Service API Documentation

**–í–µ—Ä—Å–∏—è API:** 2.0
**–ë–∞–∑–æ–≤—ã–π URL:** `http://localhost:5001` (–∏–ª–∏ `AI_SERVICE_URL`)
**–°—Ç–µ–∫:** Python (FastAPI) + OpenAI (GPT-4o-mini)

---

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`):
```ini
OPENAI_API_KEY=sk-...
MODEL=gpt-4o-mini
PORT=5001
JSON_MODE=true
```

---

## 1. üõçÔ∏è Purchase Analysis (–ê–Ω–∞–ª–∏–∑ –ø–æ–∫—É–ø–∫–∏)

### `POST /ai/purchase-advice`
–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç "–ò–Ω–¥–µ–∫—Å –ö–∞–ø—É—á–∏–Ω–æ" –∏ –¥–∞–µ—Ç —Å–æ–≤–µ—Ç.

**Request Body:**
```json
{
  "product_name": "iPhone 16 Pro",
  "price": 150000,
  "user_income": 100000,
  "user_savings": 60000,
  "monthly_savings": 10000,
  "cooling_days": 30
}
```

**Response (200 OK):**
```json
{
  "status": "COOLING", // –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: APPROVED | COOLING | BLOCKED
  "advice": "–≠—Ç–æ 1.5 —Ç–≤–æ–∏—Ö –∑–∞—Ä–ø–ª–∞—Ç—ã. –ü–æ–¥–æ–∂–¥–∏ 30 –¥–Ω–µ–π. –ö—Å—Ç–∞—Ç–∏, —ç—Ç–æ –∫–∞–∫ 750 —á–∞—à–µ–∫ –∫–æ—Ñ–µ! ‚òïÔ∏è",
  "key_message": "–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ. –û—Å—Ç—ã–Ω—å.",
  "confidence": 0.95
}
```

---

## 2. üö´ Blacklist Check (–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)

### `POST /ai/category-similarity`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ –∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º (—á–µ—Ä–µ–∑ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫).

**Request Body:**
```json
{
  "user_category": "Steam Deck",
  "blacklist_categories": ["–í–∏–¥–µ–æ–∏–≥—Ä—ã", "–§–∞—Å—Ç—Ñ—É–¥"]
}
```

**Response (200 OK):**
```json
{
  "is_blocked": true,
  "similarity": 0.92, // –û—Ç 0.0 –¥–æ 1.0
  "related_to": "–í–∏–¥–µ–æ–∏–≥—Ä—ã",
  "reason": "Steam Deck ‚Äî —ç—Ç–æ –∏–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –≤–∏–¥–µ–æ–∏–≥—Ä–∞–º."
}
```

---

## 3. üí¨ Smart Chat Agent (–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫)

### `POST /ai/chat`
–ß–∞—Ç-–±–æ—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–∞–º—è—Ç—å—é –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—Ñ—Ñ—Ç–æ–ø–∏–∫–∞. –£–º–µ–µ—Ç –æ–±—ä—è—Å–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "–ò–Ω–¥–µ–∫—Å –ö–∞–ø—É—á–∏–Ω–æ".

**Request Body:**
```json
{
  "message": "–•–æ—á—É –∫—É–ø–∏—Ç—å –∏–≥—Ä–æ–≤–æ–π –ü–ö –∑–∞ 200–∫, —á—Ç–æ –¥—É–º–∞–µ—à—å?",
  "context": {
    "nickname": "Alex",
    "monthly_income": 100000,
    "current_savings": 50000,
    "monthly_savings": 10000,
    "wishlist_summary": "–ü—É—Å—Ç–æ",
    "blacklist_categories": [],
    "expense_stats": "–ï–¥–∞: 10–∫"
  },
  "history": [
    { "role": "user", "content": "–ü—Ä–∏–≤–µ—Ç!" },
    { "role": "assistant", "content": "–ü—Ä–∏–≤–µ—Ç, –ê–ª–µ–∫—Å! –ß–µ–º –ø–æ–º–æ—á—å?" }
  ]
}
```

**Response (200 OK):**
```json
{
  "reply": "–≠—Ç–æ –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ! 200–∫ ‚Äî —ç—Ç–æ –∫–∞–∫ 1000 —á–∞—à–µ–∫ –∫–æ—Ñ–µ ‚òïÔ∏è. –° —Ç–≤–æ–∏–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º–∏ 50–∫ —Ç—ã —É–π–¥–µ—à—å –≤ –º–∏–Ω—É—Å. –ù–µ —Å–æ–≤–µ—Ç—É—é.",
  "is_refusal": false
}
```

---

## 4. üîó Link Parser (–ü–∞—Ä—Å–∏–Ω–≥ —Å—Å—ã–ª–æ–∫)

### `POST /ai/parse-link`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞ –ø–æ —Å—Å—ã–ª–∫–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jina Reader + AI). –†–∞–±–æ—Ç–∞–µ—Ç —Å DNS, M.Video, –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç (Ozon/WB –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å).

**Request Body:**
```json
{
  "url": "https://www.dns-shop.ru/product/..."
}
```

**Response (200 OK):**
```json
{
  "product_name": "–ù–æ—É—Ç–±—É–∫ Apple MacBook Air 13",
  "price": 115000,
  "currency": "RUB",
  "found": true,
  "error": null
}
```

---

## 5. üìã Survey Generator (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–ø—Ä–æ—Å–æ–≤)

### `POST /ai/generate-survey`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–ø—Ä–æ—Å "–¢—ã –≤—Å—ë –µ—â—ë —Ö–æ—á–µ—à—å —ç—Ç–æ?" –¥–ª—è –≤–∏—à–ª–∏—Å—Ç–∞.

**Request Body:**
```json
{
  "wishlist_items": [
    { "name": "MacBook", "price": 150000, "days_left": 20, "status": "WAITING" }
  ],
  "nickname": "Alex",
  "monthly_savings": 5000
}
```

**Response (200 OK):**
```json
{
  "title": "–¢–≤–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —á–µ–∫-–∞–ø üìã",
  "items": [
    {
      "product_name": "MacBook",
      "question": "–í—Å—ë –µ—â—ë –º–µ—á—Ç–∞–µ—à—å –æ –º–∞–∫–±—É–∫–µ? –û—Å—Ç–∞–ª–æ—Å—å 20 –¥–Ω–µ–π! üíª",
      "options": ["–î–∞, –∂–¥—É", "–£–¥–∞–ª–∏—Ç—å", "–û—Ç–ª–æ–∂–∏—Ç—å"]
    }
  ],
  "message": "–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è!"
}
```

---

## 6. üìà Financial Strategy (–§–∏–Ω. –ø–ª–∞–Ω)

### `POST /ai/financial-plan`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π Markdown-–¥–æ–∫—É–º–µ–Ω—Ç —Å–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–∞ 3-6 –º–µ—Å—è—Ü–µ–≤.

**Request Body:**
```json
{
  "nickname": "Alex",
  "monthly_income": 120000,
  "current_savings": 150000,
  "financial_goal": "–ú–∞—à–∏–Ω–∞",
  "goal_cost": 1500000,
  "expenses_breakdown": "–ï–¥–∞: 25–∫, –ê—Ä–µ–Ω–¥–∞: 40–∫"
}
```

**Response (200 OK):**
```json
{
  "plan_markdown": "## –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è Alex\n\n**1. –ê–Ω–∞–ª–∏–∑**\n...",
  "key_steps": ["–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥—É", "–û—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å 25–∫/–º–µ—Å"]
}
```

---

## 7. üí™ Motivation (–ú–æ—Ç–∏–≤–∞—Ü–∏—è)

### `POST /ai/motivation`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫—É—é –º–æ—Ç–∏–≤–∏—Ä—É—é—â—É—é —Ñ—Ä–∞–∑—É –ø—Ä–∏ —É—Å–ø–µ—Ö–µ/–Ω–µ—É–¥–∞—á–µ.

**Request Body:**
```json
{
  "action": "product_removed", // product_ready | impulse_detected
  "product_name": "PS5",
  "nickname": "Alex",
  "price": 50000,
  "savings_delta": 5000
}
```

**Response (200 OK):**
```json
{
  "message": "–ö—Ä–∞—Å–∞–≤—á–∏–∫, –ê–ª–µ–∫—Å! üòé –û—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç PS5 –∏ —Å—ç–∫–æ–Ω–æ–º–∏–ª 50–∫. –¢–≤–æ—è –º–∞—à–∏–Ω–∞ —Å—Ç–∞–ª–∞ –±–ª–∏–∂–µ!"
}
```
